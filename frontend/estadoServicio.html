<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RF006 - Control de Estado del Servicio</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: #2c3e50;
            min-height: 100vh;
        }
        
        .app-container {
            max-width: 100%;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header con efecto glass */
        .glass-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .header-main {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        h1 {
            font-size: 2.2rem;
            font-weight: 700;
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 0;
        }
        
        .priority-badge {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        .subtitle {
            color: #666;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .flow-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 12px;
            font-weight: 600;
        }
        
        .flow-arrow {
            color: #667eea;
            font-size: 1.2rem;
        }
        
        /* Tablero Kanban */
        .kanban-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            height: calc(100vh - 200px);
        }
        
        .kanban-column {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            display: flex;
            flex-direction: column;
        }
        
        .column-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .column-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.1rem;
            font-weight: 700;
            color: #2c3e50;
        }
        
        .column-badge {
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .column-content {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        /* Tarjetas de Servicio */
        .service-card {
            background: white;
            border-radius: 12px;
            padding: 18px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
            border-left: 4px solid #667eea;
            cursor: grab;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .service-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }
        
        .service-card.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }
        
        .service-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }
        
        .service-id {
            font-weight: 700;
            color: #667eea;
            font-size: 0.9rem;
        }
        
        .service-priority {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
        }
        
        .priority-high {
            background: #ffeaa7;
            color: #e17055;
        }
        
        .priority-medium {
            background: #a29bfe;
            color: white;
        }
        
        .service-client {
            font-weight: 600;
            margin-bottom: 5px;
            color: #2c3e50;
        }
        
        .service-vehicle {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }
        
        .service-description {
            color: #555;
            font-size: 0.85rem;
            line-height: 1.4;
            margin-bottom: 12px;
        }
        
        .service-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            color: #888;
        }
        
        .service-technician {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .tech-avatar {
            width: 24px;
            height: 24px;
            background: #667eea;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.7rem;
            font-weight: 600;
        }
        
        .service-time {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        /* Estados de columna espec√≠ficos */
        .column-waiting {
            border-top: 4px solid #f39c12;
        }
        
        .column-waiting .column-badge {
            background: #f39c12;
        }
        
        .column-process {
            border-top: 4px solid #3498db;
        }
        
        .column-process .column-badge {
            background: #3498db;
        }
        
        .column-completed {
            border-top: 4px solid #2ecc71;
        }
        
        .column-completed .column-badge {
            background: #2ecc71;
        }
        
        .column-delivered {
            border-top: 4px solid #9b59b6;
        }
        
        .column-delivered .column-badge {
            background: #9b59b6;
        }
        
        /* Modal de Detalles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }
        
        /* Responsive */
        @media (max-width: 1200px) {
            .kanban-board {
                grid-template-columns: repeat(2, 1fr);
                height: auto;
            }
        }
        
        @media (max-width: 768px) {
            .kanban-board {
                grid-template-columns: 1fr;
            }
            
            .header-main {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .flow-indicator {
                flex-direction: column;
                gap: 5px;
            }
        }
        
        /* Animaciones */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .service-card {
            animation: slideIn 0.3s ease;
        }
        
        .column-drop-zone {
            min-height: 100px;
            border: 2px dashed #bdc3c7;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #7f8c8d;
            font-size: 0.9rem;
            margin: 10px 0;
        }
        
        .column-drop-zone.active {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="glass-header">
            <div class="header-main">
                <h1>Control de Estado del Servicio</h1>
                <span class="priority-badge">RF006 - Alta Prioridad</span>
            </div>
            <p class="subtitle">
                <span>üìã</span> Gesti√≥n visual del flujo de servicios - Arrastre y suelte para cambiar estados
            </p>
            <div class="flow-indicator">
                <span>En espera</span>
                <span class="flow-arrow">‚Üí</span>
                <span>En proceso</span>
                <span class="flow-arrow">‚Üí</span>
                <span>Finalizado</span>
                <span class="flow-arrow">‚Üí</span>
                <span>Entregado</span>
            </div>
        </div>
        
        <!-- Tablero Kanban -->
        <div class="kanban-board" id="kanbanBoard">
            <!-- Columna: En Espera -->
            <div class="kanban-column column-waiting" data-status="waiting">
                <div class="column-header">
                    <div class="column-title">
                        <span>‚è≥</span> En Espera
                        <span class="column-badge">3</span>
                    </div>
                </div>
                <div class="column-content" id="waiting-column">
                    <div class="service-card" draggable="true" data-service="SER-001">
                        <div class="service-header">
                            <div class="service-id">SER-001</div>
                            <div class="service-priority priority-high">Alta</div>
                        </div>
                        <div class="service-client">Juan P√©rez</div>
                        <div class="service-vehicle">Toyota Corolla 2020 - ABC123</div>
                        <div class="service-description">Reparaci√≥n urgente de compresor - Sistema no enfr√≠a</div>
                        <div class="service-meta">
                            <div class="service-technician">
                                <div class="tech-avatar">CM</div>
                                Carlos Mendoza
                            </div>
                            <div class="service-time">üïí 2h</div>
                        </div>
                    </div>
                    
                    <div class="service-card" draggable="true" data-service="SER-003">
                        <div class="service-header">
                            <div class="service-id">SER-003</div>
                            <div class="service-priority priority-medium">Media</div>
                        </div>
                        <div class="service-client">Ana Rodr√≠guez</div>
                        <div class="service-vehicle">Ford Focus 2018 - GHI789</div>
                        <div class="service-description">Mantenimiento preventivo programado</div>
                        <div class="service-meta">
                            <div class="service-technician">
                                <div class="tech-avatar" style="background: #2ecc71;">RS</div>
                                Roberto S√°nchez
                            </div>
                            <div class="service-time">üïí 1h</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Columna: En Proceso -->
            <div class="kanban-column column-process" data-status="process">
                <div class="column-header">
                    <div class="column-title">
                        <span>üîß</span> En Proceso
                        <span class="column-badge">2</span>
                    </div>
                </div>
                <div class="column-content" id="process-column">
                    <div class="service-card" draggable="true" data-service="SER-002">
                        <div class="service-header">
                            <div class="service-id">SER-002</div>
                            <div class="service-priority priority-high">Alta</div>
                        </div>
                        <div class="service-client">Mar√≠a Garc√≠a</div>
                        <div class="service-vehicle">Honda Civic 2019 - XYZ789</div>
                        <div class="service-description">Cambio completo de sistema de aire acondicionado</div>
                        <div class="service-meta">
                            <div class="service-technician">
                                <div class="tech-avatar" style="background: #e74c3c;">AL</div>
                                Ana L√≥pez
                            </div>
                            <div class="service-time">üïí 4h</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Columna: Finalizado -->
            <div class="kanban-column column-completed" data-status="completed">
                <div class="column-header">
                    <div class="column-title">
                        <span>‚úÖ</span> Finalizado
                        <span class="column-badge">1</span>
                    </div>
                </div>
                <div class="column-content" id="completed-column">
                    <div class="service-card" draggable="true" data-service="SER-004">
                        <div class="service-header">
                            <div class="service-id">SER-004</div>
                            <div class="service-priority priority-medium">Media</div>
                        </div>
                        <div class="service-client">Carlos L√≥pez</div>
                        <div class="service-vehicle">Nissan Sentra 2021 - DEF456</div>
                        <div class="service-description">Limpieza y recarga de gas refrigerante</div>
                        <div class="service-meta">
                            <div class="service-technician">
                                <div class="tech-avatar">CM</div>
                                Carlos Mendoza
                            </div>
                            <div class="service-time">üïí 3h</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Columna: Entregado -->
            <div class="kanban-column column-delivered" data-status="delivered">
                <div class="column-header">
                    <div class="column-title">
                        <span>üöó</span> Entregado
                        <span class="column-badge">2</span>
                    </div>
                </div>
                <div class="column-content" id="delivered-column">
                    <div class="service-card" draggable="true" data-service="SER-005">
                        <div class="service-header">
                            <div class="service-id">SER-005</div>
                            <div class="service-priority priority-medium">Media</div>
                        </div>
                        <div class="service-client">Pedro Mart√≠nez</div>
                        <div class="service-vehicle">Hyundai Tucson 2022 - JKL012</div>
                        <div class="service-description">Diagn√≥stico y reparaci√≥n de fuga en sistema</div>
                        <div class="service-meta">
                            <div class="service-technician">
                                <div class="tech-avatar" style="background: #2ecc71;">RS</div>
                                Roberto S√°nchez
                            </div>
                            <div class="service-time">üïí 5h</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal de Detalles del Servicio -->
    <div class="modal-overlay" id="serviceModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Detalles del Servicio</h2>
                <button class="modal-close" id="closeModal">&times;</button>
            </div>
            <div id="modalContent">
                <!-- Contenido din√°mico -->
            </div>
        </div>
    </div>

    <script>
        // Datos de servicios
        const services = {
            'SER-001': {
                client: 'Juan P√©rez',
                vehicle: 'Toyota Corolla 2020 - ABC123',
                description: 'Reparaci√≥n urgente de compresor - Sistema no enfr√≠a',
                technician: 'Carlos Mendoza',
                priority: 'high',
                quote: 'COT-2024-015',
                startTime: '2024-01-20 09:00',
                estimatedDuration: '2 horas'
            },
            'SER-002': {
                client: 'Mar√≠a Garc√≠a',
                vehicle: 'Honda Civic 2019 - XYZ789',
                description: 'Cambio completo de sistema de aire acondicionado',
                technician: 'Ana L√≥pez',
                priority: 'high',
                quote: 'COT-2024-016',
                startTime: '2024-01-20 10:30',
                estimatedDuration: '4 horas'
            },
            'SER-003': {
                client: 'Ana Rodr√≠guez',
                vehicle: 'Ford Focus 2018 - GHI789',
                description: 'Mantenimiento preventivo programado',
                technician: 'Roberto S√°nchez',
                priority: 'medium',
                quote: 'COT-2024-017',
                startTime: '2024-01-20 14:00',
                estimatedDuration: '1 hora'
            },
            'SER-004': {
                client: 'Carlos L√≥pez',
                vehicle: 'Nissan Sentra 2021 - DEF456',
                description: 'Limpieza y recarga de gas refrigerante',
                technician: 'Carlos Mendoza',
                priority: 'medium',
                quote: 'COT-2024-018',
                startTime: '2024-01-19 11:00',
                estimatedDuration: '3 horas'
            },
            'SER-005': {
                client: 'Pedro Mart√≠nez',
                vehicle: 'Hyundai Tucson 2022 - JKL012',
                description: 'Diagn√≥stico y reparaci√≥n de fuga en sistema',
                technician: 'Roberto S√°nchez',
                priority: 'medium',
                quote: 'COT-2024-019',
                startTime: '2024-01-19 08:00',
                estimatedDuration: '5 horas'
            }
        };

        // Variables para drag & drop
        let draggedService = null;
        let draggedElement = null;

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            initializeDragAndDrop();
            setupEventListeners();
            updateColumnCounts();
        });

        // Configurar drag & drop
        function initializeDragAndDrop() {
            const serviceCards = document.querySelectorAll('.service-card');
            const columns = document.querySelectorAll('.kanban-column');
            
            // Eventos para las tarjetas
            serviceCards.forEach(card => {
                card.addEventListener('dragstart', handleDragStart);
                card.addEventListener('dragend', handleDragEnd);
                card.addEventListener('click', handleCardClick);
            });
            
            // Eventos para las columnas
            columns.forEach(column => {
                column.addEventListener('dragover', handleDragOver);
                column.addEventListener('dragenter', handleDragEnter);
                column.addEventListener('dragleave', handleDragLeave);
                column.addEventListener('drop', handleDrop);
            });
        }

        // Handlers de drag & drop
        function handleDragStart(e) {
            draggedService = this.getAttribute('data-service');
            draggedElement = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/plain', draggedService);
        }

        function handleDragEnd() {
            this.classList.remove('dragging');
            document.querySelectorAll('.column-drop-zone').forEach(zone => {
                zone.remove();
            });
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }

        function handleDragEnter(e) {
            e.preventDefault();
            this.classList.add('active');
            
            // Crear zona de drop visual
            if (!this.querySelector('.column-drop-zone')) {
                const dropZone = document.createElement('div');
                dropZone.className = 'column-drop-zone active';
                dropZone.textContent = 'Soltar aqu√≠ para cambiar estado';
                this.querySelector('.column-content').appendChild(dropZone);
            }
        }

        function handleDragLeave() {
            this.classList.remove('active');
            const dropZone = this.querySelector('.column-drop-zone');
            if (dropZone) {
                dropZone.remove();
            }
        }

        function handleDrop(e) {
            e.preventDefault();
            this.classList.remove('active');
            
            const dropZone = this.querySelector('.column-drop-zone');
            if (dropZone) {
                dropZone.remove();
            }
            
            const newStatus = this.getAttribute('data-status');
            const oldStatus = draggedElement.closest('.kanban-column').getAttribute('data-status');
            
            // Validar flujo l√≥gico de estados
            if (!validateStateTransition(oldStatus, newStatus)) {
                alert('No se puede cambiar el estado de esa manera. El flujo debe ser: En espera ‚Üí En proceso ‚Üí Finalizado ‚Üí Entregado');
                return;
            }
            
            // Mover la tarjeta
            this.querySelector('.column-content').appendChild(draggedElement);
            
            // Actualizar contadores
            updateColumnCounts();
            
            // Mostrar confirmaci√≥n
            showStateChangeNotification(draggedService, oldStatus, newStatus);
        }

        // Validar transici√≥n de estados
        function validateStateTransition(fromState, toState) {
            const validTransitions = {
                'waiting': ['process'],
                'process': ['completed'],
                'completed': ['delivered'],
                'delivered': [] // No se puede cambiar desde entregado
            };
            
            return validTransitions[fromState].includes(toState);
        }

        // Mostrar notificaci√≥n de cambio de estado
        function showStateChangeNotification(serviceId, fromState, toState) {
            const stateNames = {
                'waiting': 'En Espera',
                'process': 'En Proceso',
                'completed': 'Finalizado',
                'delivered': 'Entregado'
            };
            
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: white;
                padding: 15px 20px;
                border-radius: 10px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.2);
                border-left: 4px solid #2ecc71;
                z-index: 1000;
                animation: slideIn 0.3s ease;
            `;
            notification.innerHTML = `
                <strong>‚úÖ Estado actualizado</strong><br>
                ${serviceId}:
                ${stateNames[fromState]} ‚Üí ${stateNames[toState]}
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Actualizar contadores de columnas
        function updateColumnCounts() {
            const columns = document.querySelectorAll('.kanban-column');
            columns.forEach(column => {
                const count = column.querySelectorAll('.service-card').length;
                const badge = column.querySelector('.column-badge');
                badge.textContent = count;
            });
        }

        // Configurar event listeners
        function setupEventListeners() {
            // Modal
            document.getElementById('closeModal').addEventListener('click', closeModal);
            document.getElementById('serviceModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal();
                }
            });
        }

        // Manejar clic en tarjeta
        function handleCardClick() {
            const serviceId = this.getAttribute('data-service');
            const service = services[serviceId];
            
            if (service) {
                showServiceDetails(serviceId, service);
            }
        }

        // Mostrar detalles del servicio
        function showServiceDetails(serviceId, service) {
            const modal = document.getElementById('serviceModal');
            const title = document.getElementById('modalTitle');
            const content = document.getElementById('modalContent');
            
            title.textContent = `Servicio ${serviceId}`;
            
            const priorityText = service.priority === 'high' ? 'Alta' : 'Media';
            const priorityClass = service.priority === 'high' ? 'priority-high' : 'priority-medium';
            
            content.innerHTML = `
                <div style="display: grid; gap: 15px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong>Cliente:</strong> ${service.client}
                        </div>
                        <span class="service-priority ${priorityClass}">${priorityText}</span>
                    </div>
                    
                    <div>
                        <strong>Veh√≠culo:</strong> ${service.vehicle}
                    </div>
                    
                    <div>
                        <strong>Descripci√≥n:</strong><br>
                        ${service.description}
                    </div>
                    
                    <div>
                        <strong>T√©cnico:</strong> ${service.technician}
                    </div>
                    
                    <div>
                        <strong>Cotizaci√≥n:</strong> ${service.quote}
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <strong>Inicio:</strong><br>
                            ${service.startTime}
                        </div>
                        <div>
                            <strong>Duraci√≥n estimada:</strong><br>
                            ${service.estimatedDuration}
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #eee;">
                        <button class="btn" style="background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;">
                            üìã Ver Cotizaci√≥n Completa
                        </button>
                    </div>
                </div>
            `;
            
            modal.style.display = 'flex';
        }

        // Cerrar modal
        function closeModal() {
            document.getElementById('serviceModal').style.display = 'none';
        }

        // Agregar estilos para botones
        const style = document.createElement('style');
        style.textContent = `
            .btn {
                transition: all 0.3s ease;
            }
            
            .btn:hover {
                transform: translateY(-1px);
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
